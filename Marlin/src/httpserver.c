/* Copyright (c) 2001, Swedish Institute of Computer Science.
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
  * are met:
  * 1. Redistributions of source code must retain the above copyright
  *    notice, this list of conditions and the following disclaimer.
  * 2. Redistributions in binary form must reproduce the above copyright
  *    notice, this list of conditions and the following disclaimer in the
  *    documentation and/or other materials provided with the distribution.
  * 3. Neither the name of the Institute nor the names of its contributors
  *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE INSTITUTE AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE INSTITUTE OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * httpd.c
 *
 * Author : Adam Dunkels <adam@sics.se>
 *
 */


#include "httpserver.h"
#include "lwip/tcp.h"
#include "fsdata.c"
#include "main.h"
#include "flash_if.h"
//#include "lcd_log.h"
#include <string.h>
#include <stdio.h>

//#include "module/temperature.h" //Elsan
//#include "sd/cardreader.h"
//extern CardReader card; 
//extern Temperature thermalManager;

int Bed_temp;
int Extr_temp;
extern char fname2[100];  
extern int print_stat;
//extern xyz_pos_t /*current_position*/cartes;

//#define USE_IAP_HTTP  //Elsan
//#ifdef USE_IAP_HTTP

static __IO uint32_t DataFlag=0;
static __IO uint32_t size =0;
static __IO uint32_t FlashWriteAddress;
static uint32_t TotalReceived=0;
static char LeftBytesTab[4];
static uint8_t LeftBytes=0;
static __IO uint8_t resetpage=0;
static uint32_t ContentLengthOffset =0,BrowserFlag=0;
static __IO uint32_t TotalData=0, checklogin=0; 
struct http_state
{
  char *file;
  u32_t left;
};

typedef enum 
{
  LoginPage = 0,
  FileUploadPage,
  UploadDonePage,
  ResetDonePage,
  WelcomePage
}htmlpageState;
  
htmlpageState htmlpage;
 
static const char http_crnl_2[4] = 
/* "\r\n--" */
{0xd, 0xa,0x2d,0x2d};
static const char octet_stream[14] = 
/* "octet-stream" */
{0x6f, 0x63, 0x74, 0x65, 0x74, 0x2d, 0x73, 0x74, 0x72, 0x65, 0x61, 0x6d,0x0d, };
static const char Content_Length[17] = 
/* Content Length */
{0x43, 0x6f, 0x6e, 0x74, 0x65, 0x6e, 0x74, 0x2d, 0x4c, 0x65, 0x6e, 0x67,0x74, 0x68, 0x3a, 0x20, };


static uint32_t Parse_Content_Length(char *data, uint32_t len);
static void IAP_HTTP_writedata(char* data, uint32_t len);

/* file must be allocated by caller and will be filled in
   by the function. */
static int fs_open(char *name, struct fs_file *file);

void DynWebPage(/*struct netconn *conn*/void);
void DynWebPage2(void);
void DynWebPage3(void);
void DynWebPage4(void);
void DynWebPage5(void);
void DynWebPage8(void);
void DynWebPage9(void);
void DynWebPage20(void);
void DynWebPage21(void);
void DynWebPage01(void);
void DynWebPage02(void);
void DynWebPage03(void);

char buf_html[5000];

u32_t nPageHits = 0;
char LEDstate;
int x_pos, y_pos, z_pos;

static const unsigned char PAGE_START[] = {
0x3c,0x21,0x44,0x4f,0x43,0x54,0x59,0x50,0x45,0x20,0x68,0x74,0x6d,0x6c,0x20,0x50,
0x55,0x42,0x4c,0x49,0x43,0x20,0x22,0x2d,0x2f,0x2f,0x57,0x33,0x43,0x2f,0x2f,0x44,
0x54,0x44,0x20,0x48,0x54,0x4d,0x4c,0x20,0x34,0x2e,0x30,0x31,0x2f,0x2f,0x45,0x4e,
0x22,0x20,0x22,0x68,0x74,0x74,0x70,0x3a,0x2f,0x2f,0x77,0x77,0x77,0x2e,0x77,0x33,
0x2e,0x6f,0x72,0x67,0x2f,0x54,0x52,0x2f,0x68,0x74,0x6d,0x6c,0x34,0x2f,0x73,0x74,
0x72,0x69,0x63,0x74,0x2e,0x64,0x74,0x64,0x22,0x3e,0x0d,0x0a,0x3c,0x68,0x74,0x6d,
0x6c,0x3e,0x0d,0x0a,0x3c,0x68,0x65,0x61,0x64,0x3e,0x0d,0x0a,0x20,0x20,0x3c,0x74,
0x69,0x74,0x6c,0x65,0x3e,0x53,0x54,0x4d,0x33,0x32,0x46,0x34,0x78,0x78,0x54,0x41,
0x53,0x4b,0x53,0x3c,0x2f,0x74,0x69,0x74,0x6c,0x65,0x3e,0x0d,0x0a,0x20,0x20,0x3c,
0x6d,0x65,0x74,0x61,0x20,0x68,0x74,0x74,0x70,0x2d,0x65,0x71,0x75,0x69,0x76,0x3d,
0x22,0x43,0x6f,0x6e,0x74,0x65,0x6e,0x74,0x2d,0x54,0x79,0x70,0x65,0x22,0x0d,0x0a,
0x20,0x63,0x6f,0x6e,0x74,0x65,0x6e,0x74,0x3d,0x22,0x74,0x65,0x78,0x74,0x2f,0x68,
0x74,0x6d,0x6c,0x3b,0x20,0x63,0x68,0x61,0x72,0x73,0x65,0x74,0x3d,0x77,0x69,0x6e,
0x64,0x6f,0x77,0x73,0x2d,0x31,0x32,0x35,0x32,0x22,0x3e,0x0d,0x0a,0x20,0x20,0x3c,
0x6d,0x65,0x74,0x61,0x20,0x68,0x74,0x74,0x70,0x2d,0x65,0x71,0x75,0x69,0x76,0x3d,
0x22,0x72,0x65,0x66,0x72,0x65,0x73,0x68,0x22,0x20,0x63,0x6f,0x6e,0x74,0x65,0x6e,
0x74,0x3d,0x22,/*0x31*/0x31,0x22,0x3e,0x0d,0x0a,0x20,0x20,0x3c,0x6d,0x65,0x74,0x61,0x20,
0x63,0x6f,0x6e,0x74,0x65,0x6e,0x74,0x3d,0x22,0x4d,0x53,0x48,0x54,0x4d,0x4c,0x20,
0x36,0x2e,0x30,0x30,0x2e,0x32,0x38,0x30,0x30,0x2e,0x31,0x35,0x36,0x31,0x22,0x20,
0x6e,0x61,0x6d,0x65,0x3d,0x22,0x47,0x45,0x4e,0x45,0x52,0x41,0x54,0x4f,0x52,0x22,
0x3e,0x0d,0x0a,0x20,0x20,0x3c,0x73,0x74,0x79,0x6c,0x65,0x20,0x3d,0x22,0x66,0x6f,
0x6e,0x74,0x2d,0x77,0x65,0x69,0x67,0x68,0x74,0x3a,0x20,0x6e,0x6f,0x72,0x6d,0x61,
0x6c,0x3b,0x20,0x66,0x6f,0x6e,0x74,0x2d,0x66,0x61,0x6d,0x69,0x6c,0x79,0x3a,0x20,
0x56,0x65,0x72,0x64,0x61,0x6e,0x61,0x3b,0x22,0x3e,0x3c,0x2f,0x73,0x74,0x79,0x6c,
0x65,0x3e,0x0d,0x0a,0x3c,0x2f,0x68,0x65,0x61,0x64,0x3e,0x0d,0x0a,0x3c,0x62,0x6f,
0x64,0x79,0x3e,0x0d,0x0a,0x3c,0x68,0x34,0x3e,0x3c,0x73,0x6d,0x61,0x6c,0x6c,0x20,
0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x66,0x6f,0x6e,0x74,0x2d,0x66,0x61,0x6d,0x69,
0x6c,0x79,0x3a,0x20,0x56,0x65,0x72,0x64,0x61,0x6e,0x61,0x3b,0x22,0x3e,0x3c,0x73,
0x6d,0x61,0x6c,0x6c,0x3e,0x3c,0x62,0x69,0x67,0x3e,0x3c,0x62,0x69,0x67,0x3e,0x3c,
0x62,0x69,0x67,0x0d,0x0a,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x66,0x6f,0x6e,
0x74,0x2d,0x77,0x65,0x69,0x67,0x68,0x74,0x3a,0x20,0x62,0x6f,0x6c,0x64,0x3b,0x22,
0x3e,0x3c,0x62,0x69,0x67,0x3e,0x3c,0x73,0x74,0x72,0x6f,0x6e,0x67,0x3e,0x3c,0x65,
0x6d,0x3e,0x3c,0x73,0x70,0x61,0x6e,0x0d,0x0a,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,
0x22,0x66,0x6f,0x6e,0x74,0x2d,0x73,0x74,0x79,0x6c,0x65,0x3a,0x20,0x69,0x74,0x61,
0x6c,0x69,0x63,0x3b,0x22,0x3e,0x53,0x54,0x4d,0x33,0x32,0x46,0x34,0x78,0x78,0x20,
0x4c,0x69,0x73,0x74,0x20,0x6f,0x66,0x20,0x74,0x61,0x73,0x6b,0x73,0x20,0x61,0x6e,
0x64,0x0d,0x0a,0x74,0x68,0x65,0x69,0x72,0x20,0x73,0x74,0x61,0x74,0x75,0x73,0x3c,
0x2f,0x73,0x70,0x61,0x6e,0x3e,0x3c,0x2f,0x65,0x6d,0x3e,0x3c,0x2f,0x73,0x74,0x72,
0x6f,0x6e,0x67,0x3e,0x3c,0x2f,0x62,0x69,0x67,0x3e,0x3c,0x2f,0x62,0x69,0x67,0x3e,
0x3c,0x2f,0x62,0x69,0x67,0x3e,0x3c,0x2f,0x62,0x69,0x67,0x3e,0x3c,0x2f,0x73,0x6d,
0x61,0x6c,0x6c,0x3e,0x3c,0x2f,0x73,0x6d,0x61,0x6c,0x6c,0x3e,0x3c,0x2f,0x68,0x34,
0x3e,0x0d,0x0a,0x3c,0x68,0x72,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x77,0x69,
0x64,0x74,0x68,0x3a,0x20,0x31,0x30,0x30,0x25,0x3b,0x20,0x68,0x65,0x69,0x67,0x68,
0x74,0x3a,0x20,0x32,0x70,0x78,0x3b,0x22,0x3e,0x3c,0x73,0x70,0x61,0x6e,0x0d,0x0a,
0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x66,0x6f,0x6e,0x74,0x2d,0x77,0x65,0x69,
0x67,0x68,0x74,0x3a,0x20,0x62,0x6f,0x6c,0x64,0x3b,0x22,0x3e,0x0d,0x0a,0x3c,0x2f,
0x73,0x70,0x61,0x6e,0x3e,0x3c,0x73,0x70,0x61,0x6e,0x20,0x73,0x74,0x79,0x6c,0x65,
0x3d,0x22,0x66,0x6f,0x6e,0x74,0x2d,0x77,0x65,0x69,0x67,0x68,0x74,0x3a,0x20,0x62,
0x6f,0x6c,0x64,0x3b,0x22,0x3e,0x0d,0x0a,0x3c,0x74,0x61,0x62,0x6c,0x65,0x20,0x73,
0x74,0x79,0x6c,0x65,0x3d,0x22,0x77,0x69,0x64,0x74,0x68,0x3a,0x20,0x39,0x36,0x31,
0x70,0x78,0x3b,0x20,0x68,0x65,0x69,0x67,0x68,0x74,0x3a,0x20,0x33,0x30,0x70,0x78,
0x3b,0x22,0x20,0x62,0x6f,0x72,0x64,0x65,0x72,0x3d,0x22,0x31,0x22,0x0d,0x0a,0x20,
0x63,0x65,0x6c,0x6c,0x70,0x61,0x64,0x64,0x69,0x6e,0x67,0x3d,0x22,0x32,0x22,0x20,
0x63,0x65,0x6c,0x6c,0x73,0x70,0x61,0x63,0x69,0x6e,0x67,0x3d,0x22,0x32,0x22,0x3e,
0x0d,0x0a,0x20,0x20,0x3c,0x74,0x62,0x6f,0x64,0x79,0x3e,0x0d,0x0a,0x20,0x20,0x20,
0x20,0x3c,0x74,0x72,0x3e,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x3c,0x74,0x64,
0x0d,0x0a,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x66,0x6f,0x6e,0x74,0x2d,0x66,
0x61,0x6d,0x69,0x6c,0x79,0x3a,0x20,0x56,0x65,0x72,0x64,0x61,0x6e,0x61,0x3b,0x20,
0x66,0x6f,0x6e,0x74,0x2d,0x77,0x65,0x69,0x67,0x68,0x74,0x3a,0x20,0x62,0x6f,0x6c,
0x64,0x3b,0x20,0x66,0x6f,0x6e,0x74,0x2d,0x73,0x74,0x79,0x6c,0x65,0x3a,0x20,0x69,
0x74,0x61,0x6c,0x69,0x63,0x3b,0x20,0x62,0x61,0x63,0x6b,0x67,0x72,0x6f,0x75,0x6e,
0x64,0x2d,0x63,0x6f,0x6c,0x6f,0x72,0x3a,0x20,0x72,0x67,0x62,0x28,0x35,0x31,0x2c,
0x20,0x35,0x31,0x2c,0x20,0x32,0x35,0x35,0x29,0x3b,0x20,0x74,0x65,0x78,0x74,0x2d,
0x61,0x6c,0x69,0x67,0x6e,0x3a,0x20,0x63,0x65,0x6e,0x74,0x65,0x72,0x3b,0x22,0x3e,
0x3c,0x73,0x6d,0x61,0x6c,0x6c,0x3e,0x3c,0x61,0x0d,0x0a,0x20,0x68,0x72,0x65,0x66,
0x3d,0x22,0x2f,0x53,0x54,0x4d,0x33,0x32,0x46,0x34,0x78,0x78,0x2e,0x68,0x74,0x6d,
0x6c,0x22,0x3e,0x3c,0x73,0x70,0x61,0x6e,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,
0x63,0x6f,0x6c,0x6f,0x72,0x3a,0x20,0x77,0x68,0x69,0x74,0x65,0x3b,0x22,0x3e,0x48,
0x6f,0x6d,0x65,0x0d,0x0a,0x70,0x61,0x67,0x65,0x3c,0x2f,0x73,0x70,0x61,0x6e,0x3e,
0x3c,0x2f,0x61,0x3e,0x3c,0x2f,0x73,0x6d,0x61,0x6c,0x6c,0x3e,0x3c,0x2f,0x74,0x64,
0x3e,0x0d,0x0a,0x20,0x20,0x20,0x20,0x20,0x20,0x3c,0x74,0x64,0x0d,0x0a,0x20,0x73,
0x74,0x79,0x6c,0x65,0x3d,0x22,0x66,0x6f,0x6e,0x74,0x2d,0x66,0x61,0x6d,0x69,0x6c,
0x79,0x3a,0x20,0x56,0x65,0x72,0x64,0x61,0x6e,0x61,0x3b,0x20,0x66,0x6f,0x6e,0x74,
0x2d,0x77,0x65,0x69,0x67,0x68,0x74,0x3a,0x20,0x62,0x6f,0x6c,0x64,0x3b,0x20,0x66,
0x6f,0x6e,0x74,0x2d,0x73,0x74,0x79,0x6c,0x65,0x3a,0x20,0x69,0x74,0x61,0x6c,0x69,
0x63,0x3b,0x20,0x62,0x61,0x63,0x6b,0x67,0x72,0x6f,0x75,0x6e,0x64,0x2d,0x63,0x6f,
0x6c,0x6f,0x72,0x3a,0x20,0x72,0x67,0x62,0x28,0x35,0x31,0x2c,0x20,0x35,0x31,0x2c,
0x20,0x32,0x35,0x35,0x29,0x3b,0x20,0x74,0x65,0x78,0x74,0x2d,0x61,0x6c,0x69,0x67,
0x6e,0x3a,0x20,0x63,0x65,0x6e,0x74,0x65,0x72,0x3b,0x22,0x3e,0x3c,0x61,0x0d,0x0a,
0x20,0x68,0x72,0x65,0x66,0x3d,0x22,0x53,0x54,0x4d,0x33,0x32,0x46,0x34,0x78,0x78,
0x41,0x44,0x43,0x2e,0x68,0x74,0x6d,0x6c,0x22,0x3e,0x3c,0x73,0x70,0x61,0x6e,0x20,
0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x66,0x6f,0x6e,0x74,0x2d,0x77,0x65,0x69,0x67,
0x68,0x74,0x3a,0x20,0x62,0x6f,0x6c,0x64,0x3b,0x22,0x3e,0x3c,0x2f,0x73,0x70,0x61,
0x6e,0x3e,0x3c,0x2f,0x61,0x3e,0x3c,0x73,0x6d,0x61,0x6c,0x6c,0x3e,0x3c,0x61,0x0d,
0x0a,0x20,0x68,0x72,0x65,0x66,0x3d,0x22,0x2f,0x53,0x54,0x4d,0x33,0x32,0x46,0x34,
0x78,0x78,0x54,0x41,0x53,0x4b,0x53,0x2e,0x68,0x74,0x6d,0x6c,0x22,0x3e,0x3c,0x73,
0x70,0x61,0x6e,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x63,0x6f,0x6c,0x6f,0x72,
0x3a,0x20,0x77,0x68,0x69,0x74,0x65,0x3b,0x22,0x3e,0x4c,0x69,0x73,0x74,0x0d,0x0a,
0x6f,0x66,0x20,0x74,0x61,0x73,0x6b,0x73,0x3c,0x2f,0x73,0x70,0x61,0x6e,0x3e,0x3c,
0x2f,0x61,0x3e,0x3c,0x2f,0x73,0x6d,0x61,0x6c,0x6c,0x3e,0x3c,0x2f,0x74,0x64,0x3e,
0x0d,0x0a,0x20,0x20,0x20,0x20,0x3c,0x2f,0x74,0x72,0x3e,0x0d,0x0a,0x20,0x20,0x3c,
0x2f,0x74,0x62,0x6f,0x64,0x79,0x3e,0x0d,0x0a,0x3c,0x2f,0x74,0x61,0x62,0x6c,0x65,
0x3e,0x0d,0x0a,0x3c,0x62,0x72,0x3e,0x0d,0x0a,0x3c,0x2f,0x73,0x70,0x61,0x6e,0x3e,
0x3c,0x73,0x70,0x61,0x6e,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x66,0x6f,0x6e,
0x74,0x2d,0x77,0x65,0x69,0x67,0x68,0x74,0x3a,0x20,0x62,0x6f,0x6c,0x64,0x3b,0x22,
0x3e,0x3c,0x2f,0x73,0x70,0x61,0x6e,0x3e,0x3c,0x73,0x6d,0x61,0x6c,0x6c,0x3e,0x3c,
0x73,0x70,0x61,0x6e,0x0d,0x0a,0x20,0x73,0x74,0x79,0x6c,0x65,0x3d,0x22,0x66,0x6f,
0x6e,0x74,0x2d,0x66,0x61,0x6d,0x69,0x6c,0x79,0x3a,0x20,0x56,0x65,0x72,0x64,0x61,
0x6e,0x61,0x3b,0x22,0x3e,0x4e,0x75,0x6d,0x62,0x65,0x72,0x20,0x6f,0x66,0x20,0x70,
0x61,0x67,0x65,0x20,0x68,0x69,0x74,0x73,0x3a,0x0d,0x0a,0x00};


/*static const unsigned char PAGE_START2[] = {
	//const char MAIN_page[] PROGMEM = R"=====(
	0x3c ,0x21 ,0x44 ,0x4f ,0x43 ,0x54 ,0x59 ,0x50 ,0x45 ,0x20 ,0x68 ,0x74 ,0x6d ,0x6c ,0x3e ,0x0a ,0x3c ,0x68 ,0x74 ,0x6d ,0x6c ,0x3e ,0x0a ,0x3c ,0x62 ,0x6f ,0x64 ,0x79 ,0x3e ,0x0a ,0x0a ,0x3c ,0x64 ,0x69 ,0x76 ,0x20 ,0x69 ,0x64 ,0x3d ,0x22 ,0x64 ,0x65 ,0x6d ,0x6f ,0x22 ,0x3e ,0x0a ,0x3c ,0x68 ,0x31 ,0x3e ,0x54 ,0x68 ,0x65 ,0x20 ,0x45 ,0x53 ,0x50 ,0x38 ,0x32 ,0x36 ,0x36 ,0x20 ,0x4e ,0x6f ,0x64 ,0x65 ,0x4d ,0x43 ,0x55 ,0x20 ,0x55 ,0x70 ,0x64 ,0x61 ,0x74 ,0x65 ,0x20 ,0x77 ,0x65 ,0x62 ,0x20 ,0x70 ,0x61 ,0x67 ,0x65 ,0x20 ,0x77 ,0x69 ,0x74 ,0x68 ,0x6f ,0x75 ,0x74 ,0x20 ,0x72 ,0x65 ,0x66 ,0x72 ,0x65 ,0x73 ,0x68 ,0x3c ,0x2f ,0x68 ,0x31 ,0x3e ,0x0a ,0x09 ,0x3c ,0x62 ,0x75 ,0x74 ,0x74 ,0x6f ,0x6e ,0x20 ,0x74 ,0x79 ,0x70 ,0x65 ,0x3d ,0x22 ,0x62 ,0x75 ,0x74 ,0x74 ,0x6f ,0x6e ,0x22 ,0x20 ,0x6f ,0x6e ,0x63 ,0x6c ,0x69 ,0x63 ,0x6b ,0x3d ,0x22 ,0x73 ,0x65 ,0x6e ,0x64 ,0x44 ,0x61 ,0x74 ,0x61 ,0x28 ,0x31 ,0x29 ,0x22 ,0x3e ,0x4c ,0x45 ,0x44 ,0x20 ,0x4f ,0x4e ,0x3c ,0x2f ,0x62 ,0x75 ,0x74 ,0x74 ,0x6f ,0x6e ,0x3e ,0x0a ,0x09 ,0x3c ,0x62 ,0x75 ,0x74 ,0x74 ,0x6f ,0x6e ,0x20 ,0x74 ,0x79 ,0x70 ,0x65 ,0x3d ,0x22 ,0x62 ,0x75 ,0x74 ,0x74 ,0x6f ,0x6e ,0x22 ,0x20 ,0x6f ,0x6e ,0x63 ,0x6c ,0x69 ,0x63 ,0x6b ,0x3d ,0x22 ,0x73 ,0x65 ,0x6e ,0x64 ,0x44 ,0x61 ,0x74 ,0x61 ,0x28 ,0x30 ,0x29 ,0x22 ,0x3e ,0x4c ,0x45 ,0x44 ,0x20 ,0x4f ,0x46 ,0x46 ,0x3c ,0x2f ,0x62 ,0x75 ,0x74 ,0x74 ,0x6f ,0x6e ,0x3e ,0x3c ,0x42 ,0x52 ,0x3e ,0x0a ,0x3c ,0x2f ,0x64 ,0x69 ,0x76 ,0x3e ,0x0a ,0x0a ,0x3c ,0x64 ,0x69 ,0x76 ,0x3e ,0x0a ,0x09 ,0x41 ,0x44 ,0x43 ,0x20 ,0x56 ,0x61 ,0x6c ,0x75 ,0x65 ,0x20 ,0x69 ,0x73 ,0x20 ,0x3a ,0x20 ,0x3c ,0x73 ,0x70 ,0x61 ,0x6e ,0x20 ,0x69 ,0x64 ,0x3d ,0x22 ,0x41 ,0x44 ,0x43 ,0x56 ,0x61 ,0x6c ,0x75 ,0x65 ,0x22 ,0x3e ,0x30 ,0x3c ,0x2f ,0x73 ,0x70 ,0x61 ,0x6e ,0x3e ,0x3c ,0x62 ,0x72 ,0x3e ,0x0a ,0x20 ,0x20 ,0x20 ,0x20 ,0x4c ,0x45 ,0x44 ,0x20 ,0x53 ,0x74 ,0x61 ,0x74 ,0x65 ,0x20 ,0x69 ,0x73 ,0x20 ,0x3a ,0x20 ,0x3c ,0x73 ,0x70 ,0x61 ,0x6e ,0x20 ,0x69 ,0x64 ,0x3d ,0x22 ,0x4c ,0x45 ,0x44 ,0x53 ,0x74 ,0x61 ,0x74 ,0x65 ,0x22 ,0x3e ,0x4e ,0x41 ,0x3c ,0x2f ,0x73 ,0x70 ,0x61 ,0x6e ,0x3e ,0x0a ,0x3c ,0x2f ,0x64 ,0x69 ,0x76 ,0x3e ,0x0a ,0x3c ,0x73 ,0x63 ,0x72 ,0x69 ,0x70 ,0x74 ,0x3e ,0x0a ,0x66 ,0x75 ,0x6e ,0x63 ,0x74 ,0x69 ,0x6f ,0x6e ,0x20 ,0x73 ,0x65 ,0x6e ,0x64 ,0x44 ,0x61 ,0x74 ,0x61 ,0x28 ,0x6c ,0x65 ,0x64 ,0x29 ,0x20 ,0x7b ,0x0a ,0x20 ,0x20 ,0x76 ,0x61 ,0x72 ,0x20 ,0x78 ,0x68 ,0x74 ,0x74 ,0x70 ,0x20 ,0x3d ,0x20 ,0x6e ,0x65 ,0x77 ,0x20 ,0x58 ,0x4d ,0x4c ,0x48 ,0x74 ,0x74 ,0x70 ,0x52 ,0x65 ,0x71 ,0x75 ,0x65 ,0x73 ,0x74 ,0x28 ,0x29 ,0x3b ,0x0a ,0x20 ,0x20 ,0x78 ,0x68 ,0x74 ,0x74 ,0x70 ,0x2e ,0x6f ,0x6e ,0x72 ,0x65 ,0x61 ,0x64 ,0x79 ,0x73 ,0x74 ,0x61 ,0x74 ,0x65 ,0x63 ,0x68 ,0x61 ,0x6e ,0x67 ,0x65 ,0x20 ,0x3d ,0x20 ,0x66 ,0x75 ,0x6e ,0x63 ,0x74 ,0x69 ,0x6f ,0x6e ,0x28 ,0x29 ,0x20 ,0x7b ,0x0a ,0x20 ,0x20 ,0x20 ,0x20 ,0x69 ,0x66 ,0x20 ,0x28 ,0x74 ,0x68 ,0x69 ,0x73 ,0x2e ,0x72 ,0x65 ,0x61 ,0x64 ,0x79 ,0x53 ,0x74 ,0x61 ,0x74 ,0x65 ,0x20 ,0x3d ,0x3d ,0x20 ,0x34 ,0x20 ,0x26 ,0x26 ,0x20 ,0x74 ,0x68 ,0x69 ,0x73 ,0x2e ,0x73 ,0x74 ,0x61 ,0x74 ,0x75 ,0x73 ,0x20 ,0x3d ,0x3d ,0x20 ,0x32 ,0x30 ,0x30 ,0x29 ,0x20 ,0x7b ,0x0a ,0x20 ,0x20 ,0x20 ,0x20 ,0x20 ,0x20 ,0x64 ,0x6f ,0x63 ,0x75 ,0x6d ,0x65 ,0x6e ,0x74 ,0x2e ,0x67 ,0x65 ,0x74 ,0x45 ,0x6c ,0x65 ,0x6d ,0x65 ,0x6e ,0x74 ,0x42 ,0x79 ,0x49 ,0x64 ,0x28 ,0x22 ,0x4c ,0x45 ,0x44 ,0x53 ,0x74 ,0x61 ,0x74 ,0x65 ,0x22 ,0x29 ,0x2e ,0x69 ,0x6e ,0x6e ,0x65 ,0x72 ,0x48 ,0x54 ,0x4d ,0x4c ,0x20 ,0x3d ,0x0a ,0x20 ,0x20 ,0x20 ,0x20 ,0x20 ,0x20 ,0x74 ,0x68 ,0x69 ,0x73 ,0x2e ,0x72 ,0x65 ,0x73 ,0x70 ,0x6f ,0x6e ,0x73 ,0x65 ,0x54 ,0x65 ,0x78 ,0x74 ,0x3b ,0x0a ,0x20 ,0x20 ,0x20 ,0x20 ,0x7d ,0x0a ,0x20 ,0x20 ,0x7d ,0x3b ,0x0a ,0x20 ,0x20 ,0x78 ,0x68 ,0x74 ,0x74 ,0x70 ,0x2e ,0x6f ,0x70 ,0x65 ,0x6e ,0x28 ,0x22 ,0x47 ,0x45 ,0x54 ,0x22 ,0x2c ,0x20 ,0x22 ,0x73 ,0x65 ,0x74 ,0x4c ,0x45 ,0x44 ,0x3f ,0x4c ,0x45 ,0x44 ,0x73 ,0x74 ,0x61 ,0x74 ,0x65 ,0x3d ,0x22 ,0x2b ,0x6c ,0x65 ,0x64 ,0x2c ,0x20 ,0x74 ,0x72 ,0x75 ,0x65 ,0x29 ,0x3b ,0x0a ,0x20 ,0x20 ,0x78 ,0x68 ,0x74 ,0x74 ,0x70 ,0x2e ,0x73 ,0x65 ,0x6e ,0x64 ,0x28 ,0x29 ,0x3b ,0x0a ,0x7d ,0x0a ,0x0a ,0x73 ,0x65 ,0x74 ,0x49 ,0x6e ,0x74 ,0x65 ,0x72 ,0x76 ,0x61 ,0x6c ,0x28 ,0x66 ,0x75 ,0x6e ,0x63 ,0x74 ,0x69 ,0x6f ,0x6e ,0x28 ,0x29 ,0x20 ,0x7b ,0x0a ,0x20 ,0x20 ,0x2f ,0x2f ,0x20 ,0x43 ,0x61 ,0x6c ,0x6c ,0x20 ,0x61 ,0x20 ,0x66 ,0x75 ,0x6e ,0x63 ,0x74 ,0x69 ,0x6f ,0x6e ,0x20 ,0x72 ,0x65 ,0x70 ,0x65 ,0x74 ,0x61 ,0x74 ,0x69 ,0x76 ,0x65 ,0x6c ,0x79 ,0x20 ,0x77 ,0x69 ,0x74 ,0x68 ,0x20 ,0x32 ,0x20 ,0x53 ,0x65 ,0x63 ,0x6f ,0x6e ,0x64 ,0x20 ,0x69 ,0x6e ,0x74 ,0x65 ,0x72 ,0x76 ,0x61 ,0x6c ,0x0a ,0x20 ,0x20 ,0x67 ,0x65 ,0x74 ,0x44 ,0x61 ,0x74 ,0x61 ,0x28 ,0x29 ,0x3b ,0x0a ,0x7d ,0x2c ,0x20 ,0x32 ,0x30 ,0x30 ,0x30 ,0x29 ,0x3b ,0x20 ,0x2f ,0x2f ,0x32 ,0x30 ,0x30 ,0x30 ,0x6d ,0x53 ,0x65 ,0x63 ,0x6f ,0x6e ,0x64 ,0x73 ,0x20 ,0x75 ,0x70 ,0x64 ,0x61 ,0x74 ,0x65 ,0x20 ,0x72 ,0x61 ,0x74 ,0x65 ,0x0a ,0x0a ,0x66 ,0x75 ,0x6e ,0x63 ,0x74 ,0x69 ,0x6f ,0x6e ,0x20 ,0x67 ,0x65 ,0x74 ,0x44 ,0x61 ,0x74 ,0x61 ,0x28 ,0x29 ,0x20 ,0x7b ,0x0a ,0x20 ,0x20 ,0x76 ,0x61 ,0x72 ,0x20 ,0x78 ,0x68 ,0x74 ,0x74 ,0x70 ,0x20 ,0x3d ,0x20 ,0x6e ,0x65 ,0x77 ,0x20 ,0x58 ,0x4d ,0x4c ,0x48 ,0x74 ,0x74 ,0x70 ,0x52 ,0x65 ,0x71 ,0x75 ,0x65 ,0x73 ,0x74 ,0x28 ,0x29 ,0x3b ,0x0a ,0x20 ,0x20 ,0x78 ,0x68 ,0x74 ,0x74 ,0x70 ,0x2e ,0x6f ,0x6e ,0x72 ,0x65 ,0x61 ,0x64 ,0x79 ,0x73 ,0x74 ,0x61 ,0x74 ,0x65 ,0x63 ,0x68 ,0x61 ,0x6e ,0x67 ,0x65 ,0x20 ,0x3d ,0x20 ,0x66 ,0x75 ,0x6e ,0x63 ,0x74 ,0x69 ,0x6f ,0x6e ,0x28 ,0x29 ,0x20 ,0x7b ,0x0a ,0x20 ,0x20 ,0x20 ,0x20 ,0x69 ,0x66 ,0x20 ,0x28 ,0x74 ,0x68 ,0x69 ,0x73 ,0x2e ,0x72 ,0x65 ,0x61 ,0x64 ,0x79 ,0x53 ,0x74 ,0x61 ,0x74 ,0x65 ,0x20 ,0x3d ,0x3d ,0x20 ,0x34 ,0x20 ,0x26 ,0x26 ,0x20 ,0x74 ,0x68 ,0x69 ,0x73 ,0x2e ,0x73 ,0x74 ,0x61 ,0x74 ,0x75 ,0x73 ,0x20 ,0x3d ,0x3d ,0x20 ,0x32 ,0x30 ,0x30 ,0x29 ,0x20 ,0x7b ,0x0a ,0x20 ,0x20 ,0x20 ,0x20 ,0x20 ,0x20 ,0x64 ,0x6f ,0x63 ,0x75 ,0x6d ,0x65 ,0x6e ,0x74 ,0x2e ,0x67 ,0x65 ,0x74 ,0x45 ,0x6c ,0x65 ,0x6d ,0x65 ,0x6e ,0x74 ,0x42 ,0x79 ,0x49 ,0x64 ,0x28 ,0x22 ,0x41 ,0x44 ,0x43 ,0x56 ,0x61 ,0x6c ,0x75 ,0x65 ,0x22 ,0x29 ,0x2e ,0x69 ,0x6e ,0x6e ,0x65 ,0x72 ,0x48 ,0x54 ,0x4d ,0x4c ,0x20 ,0x3d ,0x0a ,0x20 ,0x20 ,0x20 ,0x20 ,0x20 ,0x20 ,0x74 ,0x68 ,0x69 ,0x73 ,0x2e ,0x72 ,0x65 ,0x73 ,0x70 ,0x6f ,0x6e ,0x73 ,0x65 ,0x54 ,0x65 ,0x78 ,0x74 ,0x3b ,0x0a ,0x20 ,0x20 ,0x20 ,0x20 ,0x7d ,0x0a ,0x20 ,0x20 ,0x7d ,0x3b ,0x0a ,0x20 ,0x20 ,0x78 ,0x68 ,0x74 ,0x74 ,0x70 ,0x2e ,0x6f ,0x70 ,0x65 ,0x6e ,0x28 ,0x22 ,0x47 ,0x45 ,0x54 ,0x22 ,0x2c ,0x20 ,0x22 ,0x72 ,0x65 ,0x61 ,0x64 ,0x41 ,0x44 ,0x43 ,0x22 ,0x2c ,0x20 ,0x74 ,0x72 ,0x75 ,0x65 ,0x29 ,0x3b ,0x0a ,0x20 ,0x20 ,0x78 ,0x68 ,0x74 ,0x74 ,0x70 ,0x2e ,0x73 ,0x65 ,0x6e ,0x64 ,0x28 ,0x29 ,0x3b ,0x0a ,0x7d ,0x0a ,0x3c ,0x2f ,0x73 ,0x63 ,0x72 ,0x69 ,0x70 ,0x74 ,0x3e ,0x0a ,0x3c ,0x62 ,0x72 ,0x3e ,0x3c ,0x62 ,0x72 ,0x3e ,0x3c ,0x61 ,0x20 ,0x68 ,0x72 ,0x65 ,0x66 ,0x3d ,0x22 ,0x68 ,0x74 ,0x74 ,0x70 ,0x73 ,0x3a ,0x2f ,0x2f ,0x63 ,0x69 ,0x72 ,0x63 ,0x75 ,0x69 ,0x74 ,0x73 ,0x34 ,0x79 ,0x6f ,0x75 ,0x2e ,0x63 ,0x6f ,0x6d ,0x22 ,0x3e ,0x43 ,0x69 ,0x72 ,0x63 ,0x75 ,0x69 ,0x74 ,0x73 ,0x34 ,0x79 ,0x6f ,0x75 ,0x2e ,0x63 ,0x6f ,0x6d ,0x3c ,0x2f ,0x61 ,0x3e ,0x0a ,0x3c ,0x2f ,0x62 ,0x6f ,0x64 ,0x79 ,0x3e ,0x0a ,0x3c ,0x2f ,0x68 ,0x74 ,0x6d ,0x6c ,0x3e ,0x0a ,0x00
};*/

unsigned char response[] = {
	/*
	HTTP/1.1 200 OK
	Content-Type: text/plane
	Content-Length: 1
	Connection: keep-alive
	Keep-Alive: timeout=2000
	7
	*/
	0x48 ,0x54 ,0x54 ,0x50 ,0x2f ,0x31 ,0x2e ,0x31 ,0x20 ,0x32 ,0x30 ,0x30 ,0x20 ,0x4f ,0x4b ,0x0a ,0x43 ,0x6f ,0x6e ,0x74 ,0x65 ,0x6e ,0x74 ,0x2d ,0x54 ,0x79 ,0x70 ,0x65 ,0x3a ,0x20 ,0x74 ,0x65 ,0x78 ,0x74 ,0x2f ,0x70 ,0x6c ,0x61 ,0x6e ,0x65 ,0x0a ,0x43 ,0x6f ,0x6e ,0x74 ,0x65 ,0x6e ,0x74 ,0x2d ,0x4c ,0x65 ,0x6e ,0x67 ,0x74 ,0x68 ,0x3a ,0x20 ,/*0x31*/0x33 /*Content length*/,0x0a ,0x43 ,0x6f ,0x6e ,0x6e ,0x65 ,0x63 ,0x74 ,0x69 ,0x6f ,0x6e ,0x3a ,0x20 ,0x6b ,0x65 ,0x65 ,0x70 ,0x2d ,0x61 ,0x6c ,0x69 ,0x76 ,0x65 ,0x0a ,0x4b ,0x65 ,0x65 ,0x70 ,0x2d ,0x41 ,0x6c ,0x69 ,0x76 ,0x65 ,0x3a ,0x20 ,0x74 ,0x69 ,0x6d ,0x65 ,0x6f ,0x75 ,0x74 ,0x3d ,0x32 ,0x30 ,0x30 ,0x30 ,0x0a ,0x0a ,0x37, 0x37,0x37,0x00/*3.digit*/
};

unsigned char resp2[] = {
	0x48 ,0x54 ,0x54 ,0x50 ,0x2f ,0x31 ,0x2e ,0x31 ,0x20 ,0x32 ,0x30 ,0x30 ,0x20 ,0x4f ,0x4b ,0x0a ,0x43 ,0x6f ,0x6e ,0x74 ,0x65 ,0x6e ,0x74 ,0x2d ,0x54 ,0x79 ,0x70 ,0x65 ,0x3a ,0x20 ,0x74 ,0x65 ,0x78 ,0x74 ,0x2f ,0x70 ,0x6c ,0x61 ,0x6e ,0x65 ,0x0a ,0x43 ,0x6f ,0x6e ,0x74 ,0x65 ,0x6e ,0x74 ,0x2d ,0x4c ,0x65 ,0x6e ,0x67 ,0x74 ,0x68 ,0x3a ,0x20 ,/*0x31*//*0x33*/0x34,0x30 /*Content length*/,0x0a ,0x43 ,0x6f ,0x6e ,0x6e ,0x65 ,0x63 ,0x74 ,0x69 ,0x6f ,0x6e ,0x3a ,0x20 ,0x6b ,0x65 ,0x65 ,0x70 ,0x2d ,0x61 ,0x6c ,0x69 ,0x76 ,0x65 ,0x0a ,0x4b ,0x65 ,0x65 ,0x70 ,0x2d ,0x41 ,0x6c ,0x69 ,0x76 ,0x65 ,0x3a ,0x20 ,0x74 ,0x69 ,0x6d ,0x65 ,0x6f ,0x75 ,0x74 ,0x3d ,0x32 ,0x30 ,0x30 ,0x30 ,0x0a ,0x0a ,0x38, 0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x00/*9 digit*/
};

static const unsigned char PAGE_START3[] = {
		0x3c, 0x68, 0x74, 0x6d, 0x6c, 0x3e, 0x0a, 0x3c, 0x68, 0x65, 0x61, 0x64, 0x3e, 0x0a, 0x3c, 0x6d, 0x65, 0x74, 0x61, 0x20, 0x68, 0x74, 0x74, 0x70, 0x2d, 0x65, 0x71, 0x75, 0x69, 0x76, 0x3d, 0x22, 0x63, 0x6f, 0x6e, 0x74, 0x65, 0x6e, 0x74, 0x2d, 0x74, 0x79, 0x70, 0x65, 0x22, 0x0a, 0x63, 0x6f, 0x6e, 0x74, 0x65, 0x6e, 0x74, 0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x2f, 0x68, 0x74, 0x6d, 0x6c, 0x3b, 0x20, 0x63, 0x68, 0x61, 0x72, 0x73, 0x65, 0x74, 0x3d, 0x77, 0x69, 0x6e, 0x64, 0x6f, 0x77, 0x73, 0x2d, 0x31, 0x32, 0x35, 0x32, 0x22, 0x3e, 0x0a, 0x3c, 0x74, 0x69, 0x74, 0x6c, 0x65, 0x3e, 0x77, 0x65, 0x62, 0x75, 0x70, 0x64, 0x61, 0x74, 0x65, 0x3c, 0x2f, 0x74, 0x69, 0x74, 0x6c, 0x65, 0x3e, 0x0a, 0x3c, 0x2f, 0x68, 0x65, 0x61, 0x64, 0x3e, 0x0a, 0x3c, 0x62, 0x6f, 0x64, 0x79, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x30, 0x2c, 0x20, 0x30, 0x2c, 0x20, 0x30, 0x29, 0x3b, 0x22, 0x20, 0x61, 0x6c, 0x69, 0x6e, 0x6b, 0x3d, 0x22, 0x23, 0x65, 0x65, 0x30, 0x30, 0x30, 0x30, 0x22, 0x20, 0x6c, 0x69, 0x6e, 0x6b, 0x3d, 0x22, 0x23, 0x30, 0x30, 0x30, 0x30, 0x65, 0x65, 0x22, 0x0a, 0x76, 0x6c, 0x69, 0x6e, 0x6b, 0x3d, 0x22, 0x23, 0x35, 0x35, 0x31, 0x61, 0x38, 0x62, 0x22, 0x3e, 0x0a, 0x3c, 0x64, 0x69, 0x76, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x64, 0x65, 0x6d, 0x6f, 0x22, 0x3e, 0x0a, 0x3c, 0x64, 0x6c, 0x3e, 0x0a, 0x3c, 0x64, 0x74, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x2f, 0x64, 0x74, 0x3e, 0x0a, 0x3c, 0x68, 0x31, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x74, 0x65, 0x78, 0x74, 0x2d, 0x61, 0x6c, 0x69, 0x67, 0x6e, 0x3a, 0x20, 0x63, 0x65, 0x6e, 0x74, 0x65, 0x72, 0x3b, 0x20, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x33, 0x32, 0x2c, 0x20, 0x32, 0x32, 0x2c, 0x20, 0x31, 0x35, 0x33, 0x29, 0x3b, 0x20, 0x6d, 0x61, 0x72, 0x67, 0x69, 0x6e, 0x2d, 0x6c, 0x65, 0x66, 0x74, 0x3a, 0x20, 0x36, 0x38, 0x70, 0x78, 0x3b, 0x20, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x20, 0x39, 0x31, 0x37, 0x70, 0x78, 0x3b, 0x20, 0x6d, 0x61, 0x72, 0x67, 0x69, 0x6e, 0x2d, 0x74, 0x6f, 0x70, 0x3a, 0x20, 0x36, 0x31, 0x70, 0x78, 0x3b, 0x20, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x35, 0x32, 0x70, 0x78, 0x3b, 0x22, 0x3e, 0x3c, 0x73, 0x6d, 0x61, 0x6c, 0x6c, 0x3e, 0x3c, 0x73, 0x6d, 0x61, 0x6c, 0x6c, 0x3e, 0x3c, 0x62, 0x3e, 0x3c, 0x62, 0x69, 0x67, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x32, 0x35, 0x35, 0x2c, 0x20, 0x32, 0x35, 0x35, 0x2c, 0x20, 0x31, 0x30, 0x32, 0x29, 0x3b, 0x22, 0x3e, 0x3c, 0x62, 0x69, 0x67, 0x3e, 0x3c, 0x62, 0x69, 0x67, 0x3e, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x73, 0x69, 0x7a, 0x65, 0x3a, 0x20, 0x32, 0x34, 0x70, 0x78, 0x3b, 0x20, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3a, 0x20, 0x6e, 0x6f, 0x72, 0x6d, 0x61, 0x6c, 0x3b, 0x20, 0x6c, 0x65, 0x74, 0x74, 0x65, 0x72, 0x2d, 0x73, 0x70, 0x61, 0x63, 0x69, 0x6e, 0x67, 0x3a, 0x20, 0x6e, 0x6f, 0x72, 0x6d, 0x61, 0x6c, 0x3b, 0x20, 0x6f, 0x72, 0x70, 0x68, 0x61, 0x6e, 0x73, 0x3a, 0x20, 0x32, 0x3b, 0x20, 0x74, 0x65, 0x78, 0x74, 0x2d, 0x61, 0x6c, 0x69, 0x67, 0x6e, 0x3a, 0x20, 0x6c, 0x65, 0x66, 0x74, 0x3b, 0x20, 0x74, 0x65, 0x78, 0x74, 0x2d, 0x69, 0x6e, 0x64, 0x65, 0x6e, 0x74, 0x3a, 0x20, 0x30, 0x70, 0x78, 0x3b, 0x20, 0x74, 0x65, 0x78, 0x74, 0x2d, 0x74, 0x72, 0x61, 0x6e, 0x73, 0x66, 0x6f, 0x72, 0x6d, 0x3a, 0x20, 0x6e, 0x6f, 0x6e, 0x65, 0x3b, 0x20, 0x77, 0x68, 0x69, 0x74, 0x65, 0x2d, 0x73, 0x70, 0x61, 0x63, 0x65, 0x3a, 0x20, 0x6e, 0x6f, 0x72, 0x6d, 0x61, 0x6c, 0x3b, 0x20, 0x77, 0x69, 0x64, 0x6f, 0x77, 0x73, 0x3a, 0x20, 0x32, 0x3b, 0x20, 0x77, 0x6f, 0x72, 0x64, 0x2d, 0x73, 0x70, 0x61, 0x63, 0x69, 0x6e, 0x67, 0x3a, 0x20, 0x30, 0x70, 0x78, 0x3b, 0x20, 0x64, 0x69, 0x73, 0x70, 0x6c, 0x61, 0x79, 0x3a, 0x20, 0x69, 0x6e, 0x6c, 0x69, 0x6e, 0x65, 0x20, 0x21, 0x20, 0x69, 0x6d, 0x70, 0x6f, 0x72, 0x74, 0x61, 0x6e, 0x74, 0x3b, 0x20, 0x66, 0x6c, 0x6f, 0x61, 0x74, 0x3a, 0x20, 0x6e, 0x6f, 0x6e, 0x65, 0x3b, 0x20, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x3c, 0x62, 0x69, 0x67, 0x3e, 0x3c, 0x62, 0x69, 0x67, 0x3e, 0x5a, 0x61, 0x78, 0x65, 0x3c, 0x2f, 0x62, 0x69, 0x67, 0x3e, 0x3c, 0x2f, 0x62, 0x69, 0x67, 0x3e, 0x0a, 0x33, 0x44, 0x20, 0x50, 0x72, 0x69, 0x6e, 0x74, 0x69, 0x6e, 0x67, 0x20, 0x54, 0x65, 0x63, 0x68, 0x6e, 0x6f, 0x6c, 0x6f, 0x67, 0x79, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x3c, 0x2f, 0x62, 0x69, 0x67, 0x3e, 0x3c, 0x2f, 0x62, 0x69, 0x67, 0x3e, 0x3c, 0x2f, 0x62, 0x69, 0x67, 0x3e, 0x3c, 0x2f, 0x62, 0x3e, 0x3c, 0x2f, 0x73, 0x6d, 0x61, 0x6c, 0x6c, 0x3e, 0x3c, 0x2f, 0x73, 0x6d, 0x61, 0x6c, 0x6c, 0x3e, 0x3c, 0x2f, 0x68, 0x31, 0x3e, 0x0a, 0x3c, 0x2f, 0x64, 0x6c, 0x3e, 0x0a, 0x3c, 0x62, 0x75, 0x74, 0x74, 0x6f, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x32, 0x35, 0x35, 0x2c, 0x20, 0x32, 0x30, 0x34, 0x2c, 0x20, 0x30, 0x29, 0x3b, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3d, 0x22, 0x62, 0x75, 0x74, 0x74, 0x6f, 0x6e, 0x22, 0x0a, 0x6f, 0x6e, 0x63, 0x6c, 0x69, 0x63, 0x6b, 0x3d, 0x22, 0x73, 0x65, 0x6e, 0x64, 0x44, 0x61, 0x74, 0x61, 0x28, 0x31, 0x29, 0x22, 0x3e, 0x50, 0x72, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x20, 0x4f, 0x4e, 0x3c, 0x2f, 0x62, 0x75, 0x74, 0x74, 0x6f, 0x6e, 0x3e, 0x20, 0x3c, 0x62, 0x75, 0x74, 0x74, 0x6f, 0x6e, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x62, 0x61, 0x63, 0x6b, 0x67, 0x72, 0x6f, 0x75, 0x6e, 0x64, 0x2d, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x35, 0x31, 0x2c, 0x20, 0x35, 0x31, 0x2c, 0x20, 0x32, 0x35, 0x35, 0x29, 0x3b, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3d, 0x22, 0x62, 0x75, 0x74, 0x74, 0x6f, 0x6e, 0x22, 0x0a, 0x6f, 0x6e, 0x63, 0x6c, 0x69, 0x63, 0x6b, 0x3d, 0x22, 0x73, 0x65, 0x6e, 0x64, 0x44, 0x61, 0x74, 0x61, 0x28, 0x30, 0x29, 0x22, 0x3e, 0x50, 0x72, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x20, 0x4f, 0x46, 0x46, 0x3c, 0x2f, 0x62, 0x75, 0x74, 0x74, 0x6f, 0x6e, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x0a, 0x3c, 0x64, 0x69, 0x76, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x0a, 0x3c, 0x64, 0x69, 0x76, 0x3e, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x50, 0x72, 0x69, 0x6e, 0x74, 0x20, 0x4d, 0x6f, 0x64, 0x65, 0x6c, 0x20, 0x3a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x20, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x32, 0x30, 0x34, 0x2c, 0x20, 0x30, 0x2c, 0x20, 0x30, 0x29, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x38, 0x22, 0x3e, 0x4e, 0x41, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x4d, 0x61, 0x74, 0x65, 0x72, 0x69, 0x61, 0x6c, 0x20, 0x3a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x20, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x32, 0x30, 0x34, 0x2c, 0x20, 0x30, 0x2c, 0x20, 0x30, 0x29, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x39, 0x22, 0x3e, 0x50, 0x4c, 0x41, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x0a, 0x3c, 0x64, 0x69, 0x76, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x58, 0x20, 0x3a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x65, 0x64, 0x3b, 0x22, 0x0a, 0x69, 0x64, 0x3d, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x30, 0x31, 0x22, 0x3e, 0x20, 0x30, 0x30, 0x30, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x59, 0x20, 0x3a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x65, 0x64, 0x3b, 0x22, 0x0a, 0x69, 0x64, 0x3d, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x30, 0x32, 0x22, 0x3e, 0x20, 0x30, 0x30, 0x30, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x5a, 0x20, 0x3a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x65, 0x64, 0x3b, 0x22, 0x0a, 0x69, 0x64, 0x3d, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x30, 0x33, 0x22, 0x3e, 0x20, 0x30, 0x30, 0x30, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x0a, 0x3c, 0x64, 0x69, 0x76, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x42, 0x65, 0x64, 0x20, 0x54, 0x65, 0x6d, 0x70, 0x20, 0x3a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x20, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x65, 0x64, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x41, 0x44, 0x43, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x31, 0x22, 0x3e, 0x30, 0x32, 0x35, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x45, 0x78, 0x74, 0x72, 0x75, 0x64, 0x65, 0x72, 0x20, 0x54, 0x65, 0x6d, 0x70, 0x20, 0x3a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x20, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x65, 0x64, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x41, 0x44, 0x43, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x32, 0x22, 0x3e, 0x30, 0x32, 0x35, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x45, 0x73, 0x74, 0x69, 0x6d, 0x61, 0x74, 0x65, 0x64, 0x20, 0x46, 0x69, 0x6e, 0x69, 0x73, 0x68, 0x20, 0x3a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x20, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x65, 0x64, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x41, 0x44, 0x43, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x33, 0x22, 0x3e, 0x30, 0x30, 0x30, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x66, 0x6f, 0x6e, 0x74, 0x2d, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x62, 0x6f, 0x6c, 0x64, 0x3b, 0x22, 0x3e, 0x50, 0x72, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x20, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x20, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x0a, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x32, 0x30, 0x34, 0x2c, 0x20, 0x30, 0x2c, 0x20, 0x30, 0x29, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x4c, 0x45, 0x44, 0x53, 0x74, 0x61, 0x74, 0x65, 0x22, 0x3e, 0x4e, 0x41, 0x0a, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x32, 0x30, 0x34, 0x2c, 0x20, 0x30, 0x2c, 0x20, 0x30, 0x29, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x4c, 0x45, 0x44, 0x53, 0x74, 0x61, 0x74, 0x65, 0x22, 0x3e, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x20, 0x3c, 0x2f, 0x64, 0x69, 0x76, 0x3e, 0x0a, 0x3c, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x3e, 0x0a, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x73, 0x65, 0x6e, 0x64, 0x44, 0x61, 0x74, 0x61, 0x28, 0x6c, 0x65, 0x64, 0x29, 0x20, 0x7b, 0x0a, 0x76, 0x61, 0x72, 0x20, 0x78, 0x68, 0x74, 0x74, 0x70, 0x20, 0x3d, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x58, 0x4d, 0x4c, 0x48, 0x74, 0x74, 0x70, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x28, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x6e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x73, 0x74, 0x61, 0x74, 0x65, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x69, 0x66, 0x20, 0x28, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3d, 0x3d, 0x20, 0x34, 0x20, 0x26, 0x26, 0x20, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3d, 0x3d, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7b, 0x0a, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x2e, 0x67, 0x65, 0x74, 0x45, 0x6c, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x42, 0x79, 0x49, 0x64, 0x28, 0x22, 0x4c, 0x45, 0x44, 0x53, 0x74, 0x61, 0x74, 0x65, 0x22, 0x29, 0x2e, 0x69, 0x6e, 0x6e, 0x65, 0x72, 0x48, 0x54, 0x4d, 0x4c, 0x20, 0x3d, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x54, 0x65, 0x78, 0x74, 0x3b, 0x0a, 0x7d, 0x0a, 0x7d, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x28, 0x22, 0x47, 0x45, 0x54, 0x22, 0x2c, 0x20, 0x22, 0x73, 0x65, 0x74, 0x4c, 0x45, 0x44, 0x3f, 0x4c, 0x45, 0x44, 0x73, 0x74, 0x61, 0x74, 0x65, 0x3d, 0x22, 0x2b, 0x6c, 0x65, 0x64, 0x2c, 0x20, 0x74, 0x72, 0x75, 0x65, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x73, 0x65, 0x6e, 0x64, 0x28, 0x29, 0x3b, 0x0a, 0x7d, 0x0a, 0x73, 0x65, 0x74, 0x49, 0x6e, 0x74, 0x65, 0x72, 0x76, 0x61, 0x6c, 0x28, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x2f, 0x2f, 0x20, 0x43, 0x61, 0x6c, 0x6c, 0x20, 0x61, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x72, 0x65, 0x70, 0x65, 0x74, 0x61, 0x74, 0x69, 0x76, 0x65, 0x6c, 0x79, 0x20, 0x77, 0x69, 0x74, 0x68, 0x20, 0x32, 0x20, 0x53, 0x65, 0x63, 0x6f, 0x6e, 0x64, 0x20, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x76, 0x61, 0x6c, 0x0a, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x28, 0x29, 0x3b, 0x0a, 0x7d, 0x2c, 0x20, 0x32, 0x30, 0x30, 0x30, 0x29, 0x3b, 0x20, 0x2f, 0x2f, 0x32, 0x30, 0x30, 0x30, 0x6d, 0x53, 0x65, 0x63, 0x6f, 0x6e, 0x64, 0x73, 0x20, 0x75, 0x70, 0x64, 0x61, 0x74, 0x65, 0x20, 0x72, 0x61, 0x74, 0x65, 0x0a, 0x0a, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x76, 0x61, 0x72, 0x20, 0x78, 0x68, 0x74, 0x74, 0x70, 0x20, 0x3d, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x58, 0x4d, 0x4c, 0x48, 0x74, 0x74, 0x70, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x28, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x6e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x73, 0x74, 0x61, 0x74, 0x65, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x69, 0x66, 0x20, 0x28, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3d, 0x3d, 0x20, 0x34, 0x20, 0x26, 0x26, 0x20, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3d, 0x3d, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7b, 0x0a, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x2e, 0x67, 0x65, 0x74, 0x45, 0x6c, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x42, 0x79, 0x49, 0x64, 0x28, 0x22, 0x41, 0x44, 0x43, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x31, 0x22, 0x29, 0x2e, 0x69, 0x6e, 0x6e, 0x65, 0x72, 0x48, 0x54, 0x4d, 0x4c, 0x20, 0x3d, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x54, 0x65, 0x78, 0x74, 0x3b, 0x0a, 0x7d, 0x0a, 0x7d, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x28, 0x22, 0x47, 0x45, 0x54, 0x22, 0x2c, 0x20, 0x22, 0x72, 0x65, 0x61, 0x64, 0x41, 0x44, 0x43, 0x31, 0x22, 0x2c, 0x20, 0x74, 0x72, 0x75, 0x65, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x73, 0x65, 0x6e, 0x64, 0x28, 0x29, 0x3b, 0x0a, 0x73, 0x65, 0x74, 0x54, 0x69, 0x6d, 0x65, 0x6f, 0x75, 0x74, 0x28, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x32, 0x28, 0x29, 0x2c, 0x34, 0x30, 0x30, 0x29, 0x3b, 0x0a, 0x7d, 0x0a, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x32, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x76, 0x61, 0x72, 0x20, 0x78, 0x68, 0x74, 0x74, 0x70, 0x20, 0x3d, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x58, 0x4d, 0x4c, 0x48, 0x74, 0x74, 0x70, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x28, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x6e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x73, 0x74, 0x61, 0x74, 0x65, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x69, 0x66, 0x20, 0x28, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3d, 0x3d, 0x20, 0x34, 0x20, 0x26, 0x26, 0x20, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3d, 0x3d, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7b, 0x0a, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x2e, 0x67, 0x65, 0x74, 0x45, 0x6c, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x42, 0x79, 0x49, 0x64, 0x28, 0x22, 0x41, 0x44, 0x43, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x32, 0x22, 0x29, 0x2e, 0x69, 0x6e, 0x6e, 0x65, 0x72, 0x48, 0x54, 0x4d, 0x4c, 0x20, 0x3d, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x54, 0x65, 0x78, 0x74, 0x3b, 0x0a, 0x7d, 0x0a, 0x7d, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x28, 0x22, 0x47, 0x45, 0x54, 0x22, 0x2c, 0x20, 0x22, 0x72, 0x65, 0x61, 0x64, 0x41, 0x44, 0x43, 0x32, 0x22, 0x2c, 0x20, 0x74, 0x72, 0x75, 0x65, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x73, 0x65, 0x6e, 0x64, 0x28, 0x29, 0x3b, 0x0a, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x33, 0x28, 0x29, 0x3b, 0x0a, 0x7d, 0x0a, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x33, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x76, 0x61, 0x72, 0x20, 0x78, 0x68, 0x74, 0x74, 0x70, 0x20, 0x3d, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x58, 0x4d, 0x4c, 0x48, 0x74, 0x74, 0x70, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x28, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x6e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x73, 0x74, 0x61, 0x74, 0x65, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x69, 0x66, 0x20, 0x28, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3d, 0x3d, 0x20, 0x34, 0x20, 0x26, 0x26, 0x20, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3d, 0x3d, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7b, 0x0a, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x2e, 0x67, 0x65, 0x74, 0x45, 0x6c, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x42, 0x79, 0x49, 0x64, 0x28, 0x22, 0x41, 0x44, 0x43, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x33, 0x22, 0x29, 0x2e, 0x69, 0x6e, 0x6e, 0x65, 0x72, 0x48, 0x54, 0x4d, 0x4c, 0x20, 0x3d, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x54, 0x65, 0x78, 0x74, 0x3b, 0x0a, 0x7d, 0x0a, 0x7d, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x28, 0x22, 0x50, 0x4f, 0x53, 0x54, 0x22, 0x2c, 0x20, 0x22, 0x72, 0x65, 0x61, 0x64, 0x41, 0x44, 0x43, 0x33, 0x22, 0x2c, 0x20, 0x74, 0x72, 0x75, 0x65, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x73, 0x65, 0x6e, 0x64, 0x28, 0x29, 0x3b, 0x0a, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x34, 0x28, 0x29, 0x3b, 0x0a, 0x7d, 0x0a, 0x0a, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x34, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x76, 0x61, 0x72, 0x20, 0x78, 0x68, 0x74, 0x74, 0x70, 0x20, 0x3d, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x58, 0x4d, 0x4c, 0x48, 0x74, 0x74, 0x70, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x28, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x6e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x73, 0x74, 0x61, 0x74, 0x65, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x69, 0x66, 0x20, 0x28, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3d, 0x3d, 0x20, 0x34, 0x20, 0x26, 0x26, 0x20, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3d, 0x3d, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7b, 0x0a, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x2e, 0x67, 0x65, 0x74, 0x45, 0x6c, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x42, 0x79, 0x49, 0x64, 0x28, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x38, 0x22, 0x29, 0x2e, 0x69, 0x6e, 0x6e, 0x65, 0x72, 0x48, 0x54, 0x4d, 0x4c, 0x20, 0x3d, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x54, 0x65, 0x78, 0x74, 0x3b, 0x0a, 0x7d, 0x0a, 0x7d, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x28, 0x22, 0x50, 0x4f, 0x53, 0x54, 0x22, 0x2c, 0x20, 0x22, 0x72, 0x65, 0x61, 0x64, 0x56, 0x61, 0x6c, 0x38, 0x22, 0x2c, 0x20, 0x74, 0x72, 0x75, 0x65, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x73, 0x65, 0x6e, 0x64, 0x28, 0x29, 0x3b, 0x0a, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x35, 0x28, 0x29, 0x3b, 0x0a, 0x7d, 0x0a, 0x0a, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x35, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x76, 0x61, 0x72, 0x20, 0x78, 0x68, 0x74, 0x74, 0x70, 0x20, 0x3d, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x58, 0x4d, 0x4c, 0x48, 0x74, 0x74, 0x70, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x28, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x6e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x73, 0x74, 0x61, 0x74, 0x65, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x69, 0x66, 0x20, 0x28, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3d, 0x3d, 0x20, 0x34, 0x20, 0x26, 0x26, 0x20, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3d, 0x3d, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7b, 0x0a, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x2e, 0x67, 0x65, 0x74, 0x45, 0x6c, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x42, 0x79, 0x49, 0x64, 0x28, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x39, 0x22, 0x29, 0x2e, 0x69, 0x6e, 0x6e, 0x65, 0x72, 0x48, 0x54, 0x4d, 0x4c, 0x20, 0x3d, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x54, 0x65, 0x78, 0x74, 0x3b, 0x0a, 0x7d, 0x0a, 0x7d, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x28, 0x22, 0x50, 0x4f, 0x53, 0x54, 0x22, 0x2c, 0x20, 0x22, 0x72, 0x65, 0x61, 0x64, 0x56, 0x61, 0x6c, 0x39, 0x22, 0x2c, 0x20, 0x74, 0x72, 0x75, 0x65, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x73, 0x65, 0x6e, 0x64, 0x28, 0x29, 0x3b, 0x0a, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x30, 0x31, 0x28, 0x29, 0x3b, 0x0a, 0x7d, 0x0a, 0x0a, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x30, 0x31, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x76, 0x61, 0x72, 0x20, 0x78, 0x68, 0x74, 0x74, 0x70, 0x20, 0x3d, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x58, 0x4d, 0x4c, 0x48, 0x74, 0x74, 0x70, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x28, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x6e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x73, 0x74, 0x61, 0x74, 0x65, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x69, 0x66, 0x20, 0x28, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3d, 0x3d, 0x20, 0x34, 0x20, 0x26, 0x26, 0x20, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3d, 0x3d, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7b, 0x0a, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x2e, 0x67, 0x65, 0x74, 0x45, 0x6c, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x42, 0x79, 0x49, 0x64, 0x28, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x30, 0x31, 0x22, 0x29, 0x2e, 0x69, 0x6e, 0x6e, 0x65, 0x72, 0x48, 0x54, 0x4d, 0x4c, 0x20, 0x3d, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x54, 0x65, 0x78, 0x74, 0x3b, 0x0a, 0x7d, 0x0a, 0x7d, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x28, 0x22, 0x50, 0x4f, 0x53, 0x54, 0x22, 0x2c, 0x20, 0x22, 0x72, 0x65, 0x61, 0x64, 0x56, 0x61, 0x6c, 0x30, 0x31, 0x22, 0x2c, 0x20, 0x74, 0x72, 0x75, 0x65, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x73, 0x65, 0x6e, 0x64, 0x28, 0x29, 0x3b, 0x0a, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x30, 0x32, 0x28, 0x29, 0x3b, 0x0a, 0x7d, 0x0a, 0x0a, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x30, 0x32, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x76, 0x61, 0x72, 0x20, 0x78, 0x68, 0x74, 0x74, 0x70, 0x20, 0x3d, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x58, 0x4d, 0x4c, 0x48, 0x74, 0x74, 0x70, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x28, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x6e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x73, 0x74, 0x61, 0x74, 0x65, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x69, 0x66, 0x20, 0x28, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3d, 0x3d, 0x20, 0x34, 0x20, 0x26, 0x26, 0x20, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3d, 0x3d, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7b, 0x0a, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x2e, 0x67, 0x65, 0x74, 0x45, 0x6c, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x42, 0x79, 0x49, 0x64, 0x28, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x30, 0x32, 0x22, 0x29, 0x2e, 0x69, 0x6e, 0x6e, 0x65, 0x72, 0x48, 0x54, 0x4d, 0x4c, 0x20, 0x3d, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x54, 0x65, 0x78, 0x74, 0x3b, 0x0a, 0x7d, 0x0a, 0x7d, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x28, 0x22, 0x50, 0x4f, 0x53, 0x54, 0x22, 0x2c, 0x20, 0x22, 0x72, 0x65, 0x61, 0x64, 0x56, 0x61, 0x6c, 0x30, 0x32, 0x22, 0x2c, 0x20, 0x74, 0x72, 0x75, 0x65, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x73, 0x65, 0x6e, 0x64, 0x28, 0x29, 0x3b, 0x0a, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x30, 0x33, 0x28, 0x29, 0x3b, 0x0a, 0x7d, 0x0a, 0x0a, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x20, 0x67, 0x65, 0x74, 0x44, 0x61, 0x74, 0x61, 0x30, 0x33, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x76, 0x61, 0x72, 0x20, 0x78, 0x68, 0x74, 0x74, 0x70, 0x20, 0x3d, 0x20, 0x6e, 0x65, 0x77, 0x20, 0x58, 0x4d, 0x4c, 0x48, 0x74, 0x74, 0x70, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x28, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x6e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x73, 0x74, 0x61, 0x74, 0x65, 0x63, 0x68, 0x61, 0x6e, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x66, 0x75, 0x6e, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x28, 0x29, 0x20, 0x7b, 0x0a, 0x69, 0x66, 0x20, 0x28, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x61, 0x64, 0x79, 0x53, 0x74, 0x61, 0x74, 0x65, 0x20, 0x3d, 0x3d, 0x20, 0x34, 0x20, 0x26, 0x26, 0x20, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x20, 0x3d, 0x3d, 0x20, 0x32, 0x30, 0x30, 0x29, 0x20, 0x7b, 0x0a, 0x64, 0x6f, 0x63, 0x75, 0x6d, 0x65, 0x6e, 0x74, 0x2e, 0x67, 0x65, 0x74, 0x45, 0x6c, 0x65, 0x6d, 0x65, 0x6e, 0x74, 0x42, 0x79, 0x49, 0x64, 0x28, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x30, 0x33, 0x22, 0x29, 0x2e, 0x69, 0x6e, 0x6e, 0x65, 0x72, 0x48, 0x54, 0x4d, 0x4c, 0x20, 0x3d, 0x0a, 0x74, 0x68, 0x69, 0x73, 0x2e, 0x72, 0x65, 0x73, 0x70, 0x6f, 0x6e, 0x73, 0x65, 0x54, 0x65, 0x78, 0x74, 0x3b, 0x0a, 0x7d, 0x0a, 0x7d, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x6f, 0x70, 0x65, 0x6e, 0x28, 0x22, 0x50, 0x4f, 0x53, 0x54, 0x22, 0x2c, 0x20, 0x22, 0x72, 0x65, 0x61, 0x64, 0x56, 0x61, 0x6c, 0x30, 0x33, 0x22, 0x2c, 0x20, 0x74, 0x72, 0x75, 0x65, 0x29, 0x3b, 0x0a, 0x78, 0x68, 0x74, 0x74, 0x70, 0x2e, 0x73, 0x65, 0x6e, 0x64, 0x28, 0x29, 0x3b, 0x0a, 0x7d, 0x0a, 0x0a, 0x3c, 0x2f, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x50, 0x72, 0x69, 0x6e, 0x74, 0x65, 0x72, 0x20, 0x4d, 0x6f, 0x64, 0x65, 0x6c, 0x20, 0x3a, 0x20, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x32, 0x30, 0x34, 0x2c, 0x20, 0x30, 0x2c, 0x20, 0x30, 0x29, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x31, 0x30, 0x22, 0x3e, 0x78, 0x6c, 0x69, 0x74, 0x65, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x46, 0x57, 0x20, 0x56, 0x65, 0x72, 0x73, 0x69, 0x6f, 0x6e, 0x20, 0x3a, 0x20, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x32, 0x30, 0x34, 0x2c, 0x20, 0x30, 0x2c, 0x20, 0x30, 0x29, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x31, 0x31, 0x22, 0x3e, 0x32, 0x2e, 0x30, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x48, 0x57, 0x20, 0x56, 0x65, 0x72, 0x69, 0x73, 0x6f, 0x6e, 0x20, 0x3a, 0x20, 0x3c, 0x73, 0x70, 0x61, 0x6e, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x3a, 0x20, 0x72, 0x67, 0x62, 0x28, 0x32, 0x30, 0x34, 0x2c, 0x20, 0x30, 0x2c, 0x20, 0x30, 0x29, 0x3b, 0x22, 0x20, 0x69, 0x64, 0x3d, 0x22, 0x50, 0x52, 0x4e, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x31, 0x32, 0x22, 0x3e, 0x31, 0x2e, 0x35, 0x3c, 0x2f, 0x73, 0x70, 0x61, 0x6e, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x68, 0x72, 0x20, 0x73, 0x74, 0x79, 0x6c, 0x65, 0x3d, 0x22, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3a, 0x20, 0x31, 0x30, 0x30, 0x25, 0x3b, 0x20, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3a, 0x20, 0x32, 0x70, 0x78, 0x3b, 0x22, 0x3e, 0x3c, 0x62, 0x72, 0x3e, 0x0a, 0x3c, 0x61, 0x20, 0x68, 0x72, 0x65, 0x66, 0x3d, 0x22, 0x68, 0x74, 0x74, 0x70, 0x3a, 0x2f, 0x2f, 0x77, 0x77, 0x77, 0x2e, 0x7a, 0x61, 0x78, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x2f, 0x22, 0x3e, 0x77, 0x77, 0x77, 0x2e, 0x7a, 0x61, 0x78, 0x65, 0x2e, 0x63, 0x6f, 0x6d, 0x3c, 0x2f, 0x61, 0x3e, 0x0a, 0x3c, 0x2f, 0x62, 0x6f, 0x64, 0x79, 0x3e, 0x0a, 0x3c, 0x2f, 0x68, 0x74, 0x6d, 0x6c, 0x3e, 0x0a, 0x0a, 0x00
};

/**
  * @brief  callback function for handling connection errors
  * @param  arg: pointer to an argument to be passed to callback function
  * @param  err: LwIP error code   
  * @retval None
  */
static void conn_err(void *arg, err_t err)
{
  struct http_state *hs;

  hs = arg;
  mem_free(hs);
}

/**
  * @brief  closes tcp connection
  * @param  pcb: pointer to a tcp_pcb struct
  * @param  hs: pointer to a http_state struct
  * @retval
  */
static void close_conn(struct tcp_pcb *pcb, struct http_state *hs)
{
  tcp_arg(pcb, NULL);
  tcp_sent(pcb, NULL);
  tcp_recv(pcb, NULL);
  mem_free(hs);

  tcp_close(pcb);

}

/**
  * @brief sends data found in  member "file" of a http_state struct
  * @param pcb: pointer to a tcp_pcb struct
  * @param hs: pointer to a http_state struct
  * @retval None
  */
static void send_data(struct tcp_pcb *pcb, struct http_state *hs)
{
  err_t err;
  u16_t len;

  /* We cannot send more data than space available in the send
     buffer */
  if (tcp_sndbuf(pcb) < hs->left)
  {
    len = tcp_sndbuf(pcb);
  }
  else
  {
    len = hs->left;
  }
  err = tcp_write(pcb, hs->file, len, 0);
  if (err == ERR_OK)
  {
    hs->file += len;
    hs->left -= len;
  }
}

/**
  * @brief tcp poll callback function
  * @param arg: pointer to an argument to be passed to callback function
  * @param pcb: pointer on tcp_pcb structure
  * @retval err_t
  */
static err_t http_poll(void *arg, struct tcp_pcb *pcb)
{
  if (arg == NULL)
  {
    tcp_close(pcb);
  }
  else
  {
    send_data(pcb, (struct http_state *)arg);
  }
  return ERR_OK;
}

/**
  * @brief callback function called after a successfull TCP data packet transmission  
  * @param arg: pointer to an argument to be passed to callback function
  * @param pcb: pointer on tcp_pcb structure
  * @param len
  * @retval err : LwIP error code
  */
static err_t http_sent(void *arg, struct tcp_pcb *pcb, u16_t len)
{
  struct http_state *hs;

  hs = arg;

  if (hs->left > 0)
  {
    send_data(pcb, hs);
  }
  else
  {
    close_conn(pcb, hs);
    if(resetpage ==1)
    { 
      /* Generate a software reset */
      NVIC_SystemReset();
    }
      
  }
  return ERR_OK;
}


/**
  * @brief callback function for handling TCP HTTP traffic
  * @param arg: pointer to an argument structure to be passed to callback function
  * @param pcb: pointer to a tcp_pcb structure
  * @param p: pointer to a packet buffer
  * @param err: LwIP error code
  * @retval err
  */
static err_t http_recv(void *arg, struct tcp_pcb *pcb,  struct pbuf *p, err_t err)
{
  int32_t i,len=0;
  uint32_t DataOffset, FilenameOffset;
  char *data, *ptr, filename[40], login[LOGIN_SIZE+1];
  struct fs_file file = {0, 0};
  struct http_state *hs;

#ifdef USE_LCD
  char message[46];
#endif
  
  hs = arg;

  if (err == ERR_OK && p != NULL)
  {
    /* Inform TCP that we have taken the data */
    tcp_recved(pcb, p->tot_len);
    
    if (hs->file == NULL)
    {
      data = p->payload;
      len = p->tot_len;
      
      /* process HTTP GET Login page requests */
      if (strncmp(data, "GET / HTTP", 10) == 0)
      {
        /*send the login page (which is the index page) */
        htmlpage = LoginPage;
        fs_open("/index.html", &file);
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        /* send index.html page */ 
        send_data(pcb, hs);        
        /* Tell TCP that we wish be to informed of data that has been
        successfully sent by a call to the http_sent() function. */
        tcp_sent(pcb, http_sent);
      }

      else if (strncmp(data,"GET /js/jquery.min.js",21)==0)
      {
        fs_open("/js/jquery.min.js", &file);        
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }
      /*
      else if (strncmp(data,"GET /js/bootstrap.min.js",24)==0)
      {
        fs_open("/js/bootstrap.min.js", &file);        
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }
      */
      else if (strncmp(data,"GET /js/apexcharts.min.js",25)==0)
      {
        fs_open("/js/apexcharts.min.js", &file);        
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }

      else if (strncmp(data,"GET /js/main.js",15)==0)
      {
        fs_open("/js/main.js", &file);        
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }
      
      else if (strncmp(data,"GET /css/bootstrap.min.css",26)==0)
      {
        fs_open("/css/bootstrap.min.css", &file);        
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }
      
      else if (strncmp(data,"GET /css/main.css",17)==0)
      {
        fs_open("/css/main.css", &file);        
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }

      else if (strncmp(data,"GET /images/zaxe_small.png",26)==0)
      {
        fs_open("/images/zaxe_small.png", &file);        
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }

      /* Check if request to get ST.gif */
      else if (strncmp(data,"GET /STM32F4xx_files/ST.gif",27)==0)
      {
        fs_open("/STM32F4xx_files/ST.gif", &file);
        //netconn_write(conn, (const unsigned char*)(file.data), (size_t)file.len, NETCONN_NOCOPY);
        //fs_close(&file);
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }

      else if (strncmp(data,"GET /STM32F4xx_files/stm32.jpg",30)==0)
      {
        fs_open("/STM32F4xx_files/stm32.jpg", &file);
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }

      else if (strncmp(data,"GET /images/499.jpg",19)==0)
      {
        fs_open("/images/499.jpg", &file);
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }

      /*else if (strncmp(data,"GET /STM32F4xx_files/logo.jpg",29)==0)
      {
        fs_open("/STM32F4xx_files/logo.jpg", &file);
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }*/

      else if (strncmp(data,"GET /STM32F4xxTASKS.html", 24)==0)
      {
    	  //htmlpage = FileUploadPage;
        //fs_open("/upload.html", &file);
        //hs->file = file.data;
        //hs->left = file.len;

    	  DynWebPage();
    	  hs->file = buf_html;
    	  hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }

      //New
      else if (strncmp(data,"GET /WebUpdate.html", 19)==0)
      {
        hs->file = /*PAGE_START2*/PAGE_START3/*buf_html*/;
        hs->left = strlen(/*buf_html*//*PAGE_START2*/PAGE_START3);
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }

      else if (strncmp(data,"GET /readADC1", 13)==0)
      {
        DynWebPage2();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }

      //else if (strncmp(data,"POST /readADC3", 14)==0)
      else if (strncmp(data,"GET /readADC3", 13)==0)
      {
        DynWebPage5();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }

      //else if (strncmp(data,"POST /readVal8", 14)==0)
      else if (strncmp(data,"GET /readVal8", 13)==0)
      {
        DynWebPage8();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }
      
      else if (strncmp(data,"GET /readVal20", 14)==0)
      {
        DynWebPage20();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      } 

      else if (strncmp(data,"GET /readVal21", 14)==0)
      {
        DynWebPage21();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }  

      else if (strncmp(data,"GET /readVal22", 14)==0)
      {
        DynWebPage22();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }   

      //else if (strncmp(data,"POST /readVal9", 14)==0)
      else if (strncmp(data,"GET /readVal9", 13)==0)
      {
        DynWebPage9();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }

      //else if (strncmp(data,"POST /readVal01", 15)==0)
      else if (strncmp(data,"GET /readVal01", 14)==0)
      {
        DynWebPage01();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }

      //else if (strncmp(data,"POST /readVal02", 15)==0)
      else if (strncmp(data,"GET /readVal02", 14)==0)
      {
        DynWebPage02();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }

      //else if (strncmp(data,"POST /readVal03", 15)==0)
      else if (strncmp(data,"GET /readVal03", 14)==0)
      {
        DynWebPage03();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }

      else if (strncmp(data,"GET /readADC2", 13)==0)
      {
        DynWebPage4();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        //tcp_sent(pcb, http_sent);
      }

      else if (strncmp(data,"GET /setLED", 11)==0)
      {
        char* t_state = strstr(data,"LEDstate=");
    	  LEDstate=*(t_state+9);
        DynWebPage3();
        hs->file = buf_html;
        hs->left = strlen(buf_html);
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }
      ////////////////////////////////////////////

      else if (strncmp(data,"GET /upload.html", 16)==0)
      {
        htmlpage = FileUploadPage;
        fs_open("/upload.html", &file);
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
       }

      else if (strncmp(data,"GET /STM32F4xx.html", 19)==0)
      {
        htmlpage = WelcomePage;
        fs_open("/STM32F4xx.html", &file);
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);
        send_data(pcb, hs);
        tcp_sent(pcb, http_sent);
      }

      /* process HTTP GET reset mcu requests */
      else if ((strncmp(data, "GET /resetmcu.cgi", 17) ==0)&&(htmlpage == UploadDonePage))
      {
        htmlpage = ResetDonePage;
        fs_open("/reset.html", &file);
        hs->file = file.data;
        hs->left = file.len;
        pbuf_free(p);        
        /* send reset.html page */ 
        send_data(pcb, hs);   
        resetpage = 1;        
        /* Tell TCP that we wish be to informed of data that has been
        successfully sent by a call to the http_sent() function. */
        tcp_sent(pcb, http_sent);
      }
      
      /* process POST request for checking login */
      else if ((strncmp(data, "POST /checklogin.cgi",20)==0)&&(htmlpage== LoginPage))
      {
          /* parse packet for the username & password */
          for (i=0;i<len;i++)
          {
             if (strncmp ((char*)(data+i), "username=", 9)==0)
             {            
               sprintf((char *)login,"username=%s&password=%s",USERID,PASSWORD);
               if (strncmp((char*)(data+i), (char *)login ,LOGIN_SIZE)==0)
               {
                 //htmlpage = FileUploadPage;
                 //fs_open("/upload.html", &file);

                 //Elsan
                 htmlpage = WelcomePage;
                 fs_open("/STM32F4xx.html", &file);
               }
               else
               {
                 htmlpage = LoginPage;
                 /* reload index.html */
                 fs_open("/index.html", &file);
               }
                 hs->file = file.data;
                 hs->left = file.len; 
                 pbuf_free(p);  
                 
                 /* send index.html page */ 
                 send_data(pcb, hs);
          
                 /* Tell TCP that we wish be to informed of data that has been
                 successfully sent by a call to the http_sent() function. */
                 tcp_sent(pcb, http_sent); 
               break;
             }
          }     
      }
    
      /* process POST request for file upload and incoming data packets after POST request*/
      else if (((strncmp(data, "POST /upload.cgi",16)==0)||(DataFlag >=1))&&(htmlpage == FileUploadPage))
      { 
        DataOffset =0;
        
        /* POST Packet received */
        if (DataFlag ==0)
        { 
          BrowserFlag=0;
          TotalReceived =0;
          
          /* parse packet for Content-length field */
          size = Parse_Content_Length(data, (uint32_t)(p->tot_len));
           
          /* parse packet for the octet-stream field */
          for (i=0;i<len;i++)
          {
             if (strncmp ((char*)(data+i), octet_stream, 13)==0)
             {
               DataOffset = i+16;
               break;
             }
          }  
          /* case of MSIE8 : we do not receive data in the POST packet */ 
          if (DataOffset==0)
          {
             DataFlag++;
             BrowserFlag = 1;
             pbuf_free(p);
             return ERR_OK;
             
          }
          /* case of Mozilla Firefox : we receive data in the POST packet*/
          else
          {
            TotalReceived = len - (ContentLengthOffset + 4);
          }
        }
        
        if (((DataFlag ==1)&&(BrowserFlag==1)) || ((DataFlag ==0)&&(BrowserFlag==0)))
        { 
           if ((DataFlag ==0)&&(BrowserFlag==0)) 
           {
             DataFlag++;
           }
           else if ((DataFlag ==1)&&(BrowserFlag==1))
           {
             /* parse packet for the octet-stream field */
             for (i=0;i<len;i++)
             {
               if (strncmp ((char*)(data+i), octet_stream, 13)==0)
               {
                 DataOffset = i+16;
                 break;
               }
             }
             TotalReceived+=len;
             DataFlag++;
           }  
                
           /* parse packet for the filename field */
           FilenameOffset = 0;
           for (i=0;i<len;i++)
           {
             if (strncmp ((char*)(data+i), "filename=", 9)==0)
             {
                FilenameOffset = i+10;
                break;
             }
           }           
           i =0;
           if (FilenameOffset)
           {
             while((*(data+FilenameOffset + i)!=0x22 )&&(i < 40))
             {
               filename[i] = *(data+FilenameOffset + i);
               i++;
             }
             filename[i] = 0x0;
           }
           
           if (i==0)
           {
             htmlpage = FileUploadPage;
             /* no filename, in this case reload upload page */
             fs_open("/upload.html", &file);
             hs->file = file.data;
             hs->left = file.len;
             pbuf_free(p);
             
             /* send index.html page */ 
             send_data(pcb, hs);
          
             /* Tell TCP that we wish be to informed of data that has been
             successfully sent by a call to the http_sent() function. */
             tcp_sent(pcb, http_sent); 
             DataFlag=0;
             return ERR_OK;
             
           }
             
#ifdef USE_LCD                
           LCD_UsrLog("IAP using HTTP\n");
           sprintf(message, "File: %s",filename);
           LCD_UsrLog("%s\n",message);
           LCD_UsrLog("  State: Erasing...\n");
#endif /* USE_LCD */
          
           TotalData =0;
           /* init flash */
           //FLASH_If_Init();	//Elsan dis
           /* erase user flash area */
           //FLASH_If_Erase(USER_FLASH_FIRST_PAGE_ADDRESS); //Elsan dis
          
           FlashWriteAddress = USER_FLASH_FIRST_PAGE_ADDRESS;
          
#ifdef USE_LCD
            /*indicate start of flash programming */
           LCD_UsrLog("  State: Programming...\n");
#endif
         }
         /* DataFlag >1 => the packet is data only  */
         else 
         {
           TotalReceived +=len;
         }
        
         ptr = (char*)(data + DataOffset);
         len-= DataOffset;
        
         /* update Total data received counter */
         TotalData +=len;
        
         /* check if last data packet */
         if (TotalReceived == size)
         {
           /* if last packet need to remove the http boundary tag */
           /* parse packet for "\r\n--" starting from end of data */
           i=4; 
           while (strncmp ((char*)(data+ p->tot_len -i),http_crnl_2 , 4) && (p->tot_len -i > 0))
           {
             i++;
           }
           len-=i;
           TotalData-=i;
          
           /* write data in Flash */
           //if (len)
           //IAP_HTTP_writedata(ptr,len); //Elsan disabling this line jumps to below which is wrong. Also disable if(len).
          
           DataFlag=0;
          
#ifdef USE_LCD
          sprintf(message, "%d bytes ",(int)TotalData);
          LCD_UsrLog("Tot bytes Received: %s\n", message);
          LCD_UsrLog("  State: Prog Finished ");
#endif
          htmlpage = UploadDonePage;
          /* send uploaddone.html page */
          fs_open("/uploaddone.html", &file);
          hs->file = file.data;
          hs->left = file.len;
          send_data(pcb, hs);
          
          /* Tell TCP that we wish be to informed of data that has been
           successfully sent by a call to the http_sent() function. */
          tcp_sent(pcb, http_sent);  
        }
        /* not last data packet */
        else
        {
          /* write data in flash */
          //if(len) IAP_HTTP_writedata(ptr,len); //Elsan dis
        }
        pbuf_free(p);
      }
      else
      {

       /* Bad HTTP requests */
#ifdef USE_LCD
        LCD_ErrLog("Bad HTTP request\n");
#endif
        pbuf_free(p);	//Elsan very important !!!
        close_conn(pcb, hs);
      }
    }
    else
    {
      pbuf_free(p);
      close_conn(pcb,hs);
    }
    
  }
  if (err == ERR_OK && p == NULL)
  {
    /* received empty frame */
	//pbuf_free(p);	//Elsan
    close_conn(pcb, hs);
  }

  return ERR_OK;
}

/**
  * @brief  callback function on TCP connection setup ( on port 80)
  * @param  arg: pointer to an argument structure to be passed to callback function
  * @param  pcb: pointer to a tcp_pcb structure
  * &param  err: Lwip stack error code
  * @retval err
  */
static err_t http_accept(void *arg, struct tcp_pcb *pcb, err_t err)
{
  struct http_state *hs;	

  /* Allocate memory for the structure that holds the state of the connection */
  hs = mem_malloc(sizeof(struct http_state));	

  if (hs == NULL)
  {
    return ERR_MEM;
  }

  /* Initialize the structure. */
  hs->file = NULL;
  hs->left = 0;

  /* Tell TCP that this is the structure we wish to be passed for our
     callbacks. */
  tcp_arg(pcb, hs);

  /* Tell TCP that we wish to be informed of incoming data by a call
     to the http_recv() function. */
  tcp_recv(pcb, http_recv);

  tcp_err(pcb, conn_err);

  tcp_poll(pcb, http_poll, 10);

  return ERR_OK;
}

/**
  * @brief  intialize HTTP webserver  
  * @param  none
  * @retval None
  */
 
void IAP_httpd_init(void)
{  
  struct tcp_pcb *pcb;
  //create new pcb
  pcb = tcp_new();
  // bind HTTP traffic to pcb 
  tcp_bind(pcb, IP_ADDR_ANY, 80);
  // start listening on port 80 
  pcb = tcp_listen(pcb);
  // define callback function for TCP connection setup   
  tcp_accept(pcb, http_accept);
}


/**
  * @brief  Opens a file defined in fsdata.c ROM filesystem 
  * @param  name : pointer to a file name
  * @param  file : pointer to a fs_file structure  
  * @retval  1 if success, 0 if fail
  */
static int fs_open(char *name, struct fs_file *file)
{
  struct fsdata_file_noconst *f;

  for (f = (struct fsdata_file_noconst *)FS_ROOT; f != NULL; f = (struct fsdata_file_noconst *)f->next)
  {
    if (!strcmp(name, f->name))
    {
      file->data = f->data;
      file->len = f->len;
      return 1;
    }
  }
  return 0;
}

/**
  * @brief  Extract the Content_Length data from HTML data  
  * @param  data : pointer on receive packet buffer 
  * @param  len  : buffer length  
  * @retval size : Content_length in numeric format
  */
static uint32_t Parse_Content_Length(char *data, uint32_t len)
{
  uint32_t i=0,size=0, S=1;
  int32_t j=0;
  char sizestring[6], *ptr;
   
  ContentLengthOffset =0;
  
  /* find Content-Length data in packet buffer */
  for (i=0;i<len;i++)
  {
    if (strncmp ((char*)(data+i), Content_Length, 16)==0)
    {
      ContentLengthOffset = i+16;
      break;
    }
  }
  /* read Content-Length value */
  if (ContentLengthOffset)
  {
    i=0;
    ptr = (char*)(data + ContentLengthOffset);
    while(*(ptr+i)!=0x0d)
    {
      sizestring[i] = *(ptr+i);
      i++;
      ContentLengthOffset++; 
    }
    if (i>0)
    {
      /* transform string data into numeric format */
      for(j=i-1;j>=0;j--)
      {
        size += (sizestring[j]-'0')*S;
        S=S*10;
      }
    }
  }
  return size;
}

/**
  * @brief  writes received data in flash    
  * @param  ptr: data pointer
  * @param  len: data length
  * @retval None 
  */
static void IAP_HTTP_writedata(char * ptr, uint32_t len)            
{
  uint32_t count, i=0, j=0;
  
  /* check if any left bytes from previous packet transfer*/
  /* if it is the case do a concat with new data to create a 32-bit word */
  if (LeftBytes)
  {
    while(LeftBytes<=3)
    {
      if(len>(j+1))
      {
        LeftBytesTab[LeftBytes++] = *(ptr+j);
      }
      else
      {
        LeftBytesTab[LeftBytes++] = 0xFF;
      }
      j++;
    }
    //FLASH_If_Write(&FlashWriteAddress, (uint32_t*)(LeftBytesTab),1);
    LeftBytes =0;
    
    /* update data pointer */
    ptr = (char*)(ptr+j);
    len = len -j;
  }
  
  /* write received bytes into flash */
  count = len/4;
  
  /* check if remaining bytes < 4 */
  i= len%4;
  if (i>0)
  {
    if (TotalReceived != size)
    {
      /* store bytes in LeftBytesTab */
      LeftBytes=0;
      for(;i>0;i--)
      LeftBytesTab[LeftBytes++] = *(char*)(ptr+ len-i);  
    }
    else count++;
  }
  //FLASH_If_Write(&FlashWriteAddress, (uint32_t*)ptr ,count);
}
//#endif

/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
int test_var1=0;
int test_var2=0;
int bed_temp=25;
int extrd_temp=100;
int print_percent=0;
void DynWebPage(/*struct netconn *conn*/void)
{
  /*portCHAR*/char PAGE_BODY[512];
  /*portCHAR*/char pagehits[10] = {0};
  char buf_t[20];

  memset(PAGE_BODY, 0,512);
  buf_html[0]=0; buf_t[0]=0;
  //memset(buf_html, 0,5000);
  //memset(buf_t, 0,10);

  /* Update the hit count */
  nPageHits++;
  sprintf(pagehits, "%d", (int)nPageHits);
  strcat(PAGE_BODY, pagehits);
  strcat((char *)PAGE_BODY, "<pre><br>Name          State  Priority  Stack   Num" );
  strcat((char *)PAGE_BODY, "<br>---------------------------------------------<br>");

  /* The list of tasks and their status */
  //osThreadList((unsigned char *)(PAGE_BODY + strlen(PAGE_BODY)));
  /* Write the rest of the string. */
  sprintf(buf_t, "%s", "test_var1"); strcat(PAGE_BODY,buf_t);
  sprintf(/*pcWriteBuffer*/buf_t, "\t%d\r\n", test_var1);
  //sprintf(/*pcWriteBuffer*/PAGE_BODY+110, "\t%d\r\n", (int)nPageHits);
  //pcWriteBuffer += strlen( pcWriteBuffer );
  strcat(PAGE_BODY,buf_t);

  sprintf(buf_t, "%s", "test_var2"); strcat(PAGE_BODY,buf_t);
  sprintf(buf_t, "\t%d\r\n", test_var2);
  strcat(PAGE_BODY,buf_t);

  sprintf(buf_t, "%s", "Bed Temp"); strcat(PAGE_BODY,buf_t);
  sprintf(buf_t, "\t%d\r\n", bed_temp);
  strcat(PAGE_BODY,buf_t);

  sprintf(buf_t, "%s", "Extrd Temp"); strcat(PAGE_BODY,buf_t);
  sprintf(buf_t, "\t%d\r\n", extrd_temp);
  strcat(PAGE_BODY,buf_t);

  sprintf(buf_t, "%s", "Printing %"); strcat(PAGE_BODY,buf_t);
  sprintf(buf_t, "\t%d\r\n", print_percent);
  strcat(PAGE_BODY,buf_t);

  strcat((char *)PAGE_BODY, "<br><br>---------------------------------------------");
  //strcat((char *)PAGE_BODY, "<br>B : Blocked, R : Ready, D : Deleted, S : Suspended<br>");

  /* Send the dynamically generated page */
  //netconn_write(conn, PAGE_START, strlen((char*)PAGE_START), NETCONN_COPY);
  //netconn_write(conn, PAGE_BODY, strlen(PAGE_BODY), NETCONN_COPY);
  strcpy(buf_html, (char *)PAGE_START);
  strcat(buf_html, PAGE_BODY);

  //Simulation of test variables
  test_var1++;
  test_var2+=2;
  //print_percent+=1;
  //if(print_percent>100) print_percent=1;
}

void DynWebPage2(void)
{
  buf_html[0]=0;
  //memset(buf_html, 0,5000);

  //Simulation of test variables
  test_var1++;
  //test_var2+=2;
  //print_percent+=1;
  //if(print_percent>100) print_percent=1;

  int resp_len=strlen((const char *)response);
  //sprintf((char *)(response+resp_len-3), "%03d", test_var1);
  strcpy(buf_html, (char *)response);
  //memcpy(buf_html,response,resp_len);
  sprintf((char *)(buf_html+resp_len-3), "%03d", /*test_var1*//*thermalManager.temp_bed.celsius*/Bed_temp);
}

void DynWebPage4(void)
{
  buf_html[0]=0;
  //memset(buf_html, 0,5000);

  //test_var1++;
  test_var2+=2;
  //print_percent+=1;
  //if(print_percent>100) print_percent=1;

  int resp_len=strlen((const char *)response);
  //sprintf((char *)(response+resp_len-3), "%03d", test_var2);
  strcpy(buf_html, (char *)response);
  //memcpy(buf_html,response,resp_len);
  sprintf((char *)(buf_html+resp_len-3), "%03d", /*test_var2*/Extr_temp);
}

void DynWebPage5(void)
{
  buf_html[0]=0;

  //Simulation of test variables
  //test_var1++;
  //test_var2+=3;
  //print_percent+=1;
  //if(print_percent>100) print_percent=1;

  int resp_len=strlen((const char *)response);
  //sprintf((char *)(response+resp_len-3), "%03d", test_var2*2);
  strcpy(buf_html, (char *)response);
  sprintf((char *)(buf_html+resp_len-3), "%03d", test_var2*2);
}

void DynWebPage3(void)
{
  buf_html[0]=0;

  int resp_len=strlen((const char *)resp2);
  if(LEDstate==0x31) sprintf((char *)(resp2+resp_len-/*3*/20), "%20s", /*"PRNT ON   1234567890"*/"ON"); //Requires exact length.
  else sprintf((char *)(resp2+resp_len-/*3*/20), "%s", "PRNT OFF  1234567890");
  strcpy(buf_html, (char *)resp2);
}

void DynWebPage8(void)
{
  buf_html[0]=0;

  //int resp_len=strlen((const char *)response);
  //strcpy(buf_html, (char *)response);
  //sprintf((char *)(buf_html+resp_len-3), "%s", "GCO");

  int resp_len=strlen((const char *)resp2);
  strcpy(buf_html, (char *)resp2);
  sprintf((char *)(buf_html+resp_len-20), "%20s", "Filename.GCO");
}

void DynWebPage20(void)
{
  buf_html[0]=0;

  //int resp_len=strlen((const char *)response);
  //strcpy(buf_html, (char *)response);
  //sprintf((char *)(buf_html+resp_len-3), "%s", "GCO");

  int resp_len=strlen((const char *)resp2);
  strcpy(buf_html, (char *)resp2);
  sprintf((char *)(buf_html+resp_len-40), "%40s", fname2);
}

void DynWebPage9(void)
{
  buf_html[0]=0;

  //print_percent+=1;
  //if(print_percent>100) print_percent=1;

  int resp_len=strlen((const char *)response);
  strcpy(buf_html, (char *)response);
  sprintf((char *)(buf_html+resp_len-3), "%s", "PLA");
}

void DynWebPage01(void)
{
  buf_html[0]=0;

  //x_pos++;
  int resp_len=strlen((const char *)response);
  strcpy(buf_html, (char *)response);
  sprintf((char *)(buf_html+resp_len-3), "%03d", x_pos/*current_position.*/);
  
}

void DynWebPage02(void)
{
  buf_html[0]=0;

  //y_pos++;

  int resp_len=strlen((const char *)response);
  strcpy(buf_html, (char *)response);
  sprintf((char *)(buf_html+resp_len-3), "%03d", y_pos);
}

void DynWebPage03(void)
{
  buf_html[0]=0;

  //z_pos++;

  int resp_len=strlen((const char *)response);
  strcpy(buf_html, (char *)response);
  sprintf((char *)(buf_html+resp_len-3), "%03d", z_pos);
}

void DynWebPage21(void)
{
  buf_html[0]=0;

  //print_percent=card.percentDone();
  int resp_len=strlen((const char *)response);
  strcpy(buf_html, (char *)response);
  sprintf((char *)(buf_html+resp_len-3), "%03d", print_percent);
}

void DynWebPage22(void)
{
  buf_html[0]=0;

  //print_percent=card.percentDone();
  int resp_len=strlen((const char *)response);
  strcpy(buf_html, (char *)response);
  sprintf((char *)(buf_html+resp_len-3), "%03d", print_stat);
}
